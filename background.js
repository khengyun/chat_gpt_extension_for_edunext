"use strict";(()=>{var gr=Object.create;var Ae=Object.defineProperty;var xr=Object.getOwnPropertyDescriptor;var cr=Object.getOwnPropertyNames;var Ar=Object.getPrototypeOf,yr=Object.prototype.hasOwnProperty;var z=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var br=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of cr(r))!yr.call(e,n)&&n!==t&&Ae(e,n,{get:()=>r[n],enumerable:!(s=xr(r,n))||s.enumerable});return e};var ye=(e,r,t)=>(t=e!=null?gr(Ar(e)):{},br(r||!e||!e.__esModule?Ae(t,"default",{value:e,enumerable:!0}):t,e));var he=z((wo,be)=>{"use strict";be.exports=()=>{let e={};return e.promise=new Promise((r,t)=>{e.resolve=r,e.reject=t}),e}});var we=z((To,ve)=>{"use strict";var hr=he();function vr(e,r="maxAge"){let t,s,n,d=async()=>{if(t!==void 0)return;let b=async v=>{n=hr();let N=v[1][r]-Date.now();if(N<=0){e.delete(v[0]),n.resolve();return}return t=v[0],s=setTimeout(()=>{e.delete(v[0]),n&&n.resolve()},N),typeof s.unref=="function"&&s.unref(),n.promise};try{for(let v of e)await b(v)}catch{}t=void 0},u=()=>{t=void 0,s!==void 0&&(clearTimeout(s),s=void 0),n!==void 0&&(n.reject(void 0),n=void 0)},y=e.set.bind(e);return e.set=(b,v)=>{e.has(b)&&e.delete(b);let N=y(b,v);return t&&t===b&&u(),d(),N},d(),e}ve.exports=vr});var je=z((jo,Te)=>{"use strict";var wr=we(),ie=class{constructor(r,t){if(this.maxAge=r,this[Symbol.toStringTag]="Map",this.data=new Map,wr(this.data),t)for(let[s,n]of t)this.set(s,n)}get size(){return this.data.size}clear(){this.data.clear()}delete(r){return this.data.delete(r)}has(r){return this.data.has(r)}get(r){let t=this.data.get(r);if(t)return t.data}set(r,t){return this.data.set(r,{maxAge:Date.now()+this.maxAge,data:t}),this}values(){return this.createIterator(r=>r[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(r=>[r[0],r[1].data])}forEach(r,t){for(let[s,n]of this.entries())r.apply(t,[n,s,this])}[Symbol.iterator](){return this.entries()}*createIterator(r){for(let t of this.data.entries())yield r(t)}};Te.exports=ie});var Se=z((me,ke)=>{(function(e,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof me<"u")r(ke);else{var t={exports:{}};r(t),e.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:me,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let r="The message port closed before a response was received.",t=s=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class d extends WeakMap{constructor(a,i=void 0){super(i),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}let u=o=>o&&typeof o=="object"&&typeof o.then=="function",y=(o,a)=>(...i)=>{s.runtime.lastError?o.reject(new Error(s.runtime.lastError.message)):a.singleCallbackArg||i.length<=1&&a.singleCallbackArg!==!1?o.resolve(i[0]):o.resolve(i)},b=o=>o==1?"argument":"arguments",v=(o,a)=>function(m,...x){if(x.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${b(a.minArgs)} for ${o}(), got ${x.length}`);if(x.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${b(a.maxArgs)} for ${o}(), got ${x.length}`);return new Promise((T,k)=>{if(a.fallbackToNoCallback)try{m[o](...x,y({resolve:T,reject:k},a))}catch(f){console.warn(`${o} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,f),m[o](...x),a.fallbackToNoCallback=!1,a.noCallback=!0,T()}else a.noCallback?(m[o](...x),T()):m[o](...x,y({resolve:T,reject:k},a))})},N=(o,a,i)=>new Proxy(a,{apply(m,x,T){return i.call(x,o,...T)}}),O=Function.call.bind(Object.prototype.hasOwnProperty),h=(o,a={},i={})=>{let m=Object.create(null),x={has(k,f){return f in o||f in m},get(k,f,S){if(f in m)return m[f];if(!(f in o))return;let g=o[f];if(typeof g=="function")if(typeof a[f]=="function")g=N(o,o[f],a[f]);else if(O(i,f)){let F=v(f,i[f]);g=N(o,o[f],F)}else g=g.bind(o);else if(typeof g=="object"&&g!==null&&(O(a,f)||O(i,f)))g=h(g,a[f],i[f]);else if(O(i,"*"))g=h(g,a[f],i["*"]);else return Object.defineProperty(m,f,{configurable:!0,enumerable:!0,get(){return o[f]},set(F){o[f]=F}}),g;return m[f]=g,g},set(k,f,S,g){return f in m?m[f]=S:o[f]=S,!0},defineProperty(k,f,S){return Reflect.defineProperty(m,f,S)},deleteProperty(k,f){return Reflect.deleteProperty(m,f)}},T=Object.create(o);return new Proxy(T,x)},p=o=>({addListener(a,i,...m){a.addListener(o.get(i),...m)},hasListener(a,i){return a.hasListener(o.get(i))},removeListener(a,i){a.removeListener(o.get(i))}}),C=new d(o=>typeof o!="function"?o:function(i){let m=h(i,{},{getContent:{minArgs:0,maxArgs:0}});o(m)}),j=new d(o=>typeof o!="function"?o:function(i,m,x){let T=!1,k,f=new Promise($=>{k=function(I){T=!0,$(I)}}),S;try{S=o(i,m,k)}catch($){S=Promise.reject($)}let g=S!==!0&&u(S);if(S!==!0&&!g&&!T)return!1;let F=$=>{$.then(I=>{x(I)},I=>{let fe;I&&(I instanceof Error||typeof I.message=="string")?fe=I.message:fe="An unexpected error occurred",x({__mozWebExtensionPolyfillReject__:!0,message:fe})}).catch(I=>{console.error("Failed to send onMessage rejected reply",I)})};return F(g?S:f),!0}),E=({reject:o,resolve:a},i)=>{s.runtime.lastError?s.runtime.lastError.message===r?a():o(new Error(s.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?o(new Error(i.message)):a(i)},w=(o,a,i,...m)=>{if(m.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${b(a.minArgs)} for ${o}(), got ${m.length}`);if(m.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${b(a.maxArgs)} for ${o}(), got ${m.length}`);return new Promise((x,T)=>{let k=E.bind(null,{resolve:x,reject:T});m.push(k),i.sendMessage(...m)})},P={devtools:{network:{onRequestFinished:p(C)}},runtime:{onMessage:p(j),onMessageExternal:p(j),sendMessage:w.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:w.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},_={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":_},services:{"*":_},websites:{"*":_}},h(s,P,n)};e.exports=t(chrome)}else e.exports=globalThis.browser})});var dr=ye(je()),U=ye(Se());var K,Tr=new Uint8Array(16);function le(){if(!K&&(K=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!K))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return K(Tr)}var c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function Oe(e,r=0){return(c[e[r+0]]+c[e[r+1]]+c[e[r+2]]+c[e[r+3]]+"-"+c[e[r+4]]+c[e[r+5]]+"-"+c[e[r+6]]+c[e[r+7]]+"-"+c[e[r+8]]+c[e[r+9]]+"-"+c[e[r+10]]+c[e[r+11]]+c[e[r+12]]+c[e[r+13]]+c[e[r+14]]+c[e[r+15]]).toLowerCase()}var jr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ue={randomUUID:jr};function kr(e,r,t){if(ue.randomUUID&&!r&&!e)return ue.randomUUID();e=e||{};let s=e.random||(e.rng||le)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,r){t=t||0;for(let n=0;n<16;++n)r[t+n]=s[n];return r}return Oe(s)}var G=kr;function Ee(e){let r,t,s,n,d,u,y;return b(),{feed:v,reset:b};function b(){r=!0,t="",s=0,n=-1,d=void 0,u=void 0,y=""}function v(O){t=t?t+O:O,r&&Sr(t)&&(t=t.slice(Pe.length)),r=!1;let h=t.length,p=0,C=!1;for(;p<h;){C&&(t[p]===`
`&&++p,C=!1);let j=-1,E=n,w;for(let P=s;j<0&&P<h;++P)w=t[P],w===":"&&E<0?E=P-p:w==="\r"?(C=!0,j=P-p):w===`
`&&(j=P-p);if(j<0){s=h-p,n=E;break}else s=0,n=-1;N(t,p,E,j),p+=j+1}p===h?t="":p>0&&(t=t.slice(p))}function N(O,h,p,C){if(C===0){y.length>0&&(e({type:"event",id:d,event:u||void 0,data:y.slice(0,-1)}),y="",d=void 0),u=void 0;return}let j=p<0,E=O.slice(h,h+(j?C:p)),w=0;j?w=C:O[h+p+1]===" "?w=p+2:w=p+1;let P=h+w,_=C-w,o=O.slice(P,P+_).toString();if(E==="data")y+=o?"".concat(o,`
`):`
`;else if(E==="event")u=o;else if(E==="id"&&!o.includes("\0"))d=o;else if(E==="retry"){let a=parseInt(o,10);Number.isNaN(a)||e({type:"reconnect-interval",value:a})}}}var Pe=[239,187,191];function Sr(e){return Pe.every((r,t)=>e.charCodeAt(t)===r)}var Or=typeof global=="object"&&global&&global.Object===Object&&global,J=Or;var Er=typeof self=="object"&&self&&self.Object===Object&&self,Pr=J||Er||Function("return this")(),A=Pr;var Cr=A.Symbol,D=Cr;var Ce=Object.prototype,Ir=Ce.hasOwnProperty,Mr=Ce.toString,q=D?D.toStringTag:void 0;function Nr(e){var r=Ir.call(e,q),t=e[q];try{e[q]=void 0;var s=!0}catch{}var n=Mr.call(e);return s&&(r?e[q]=t:delete e[q]),n}var Ie=Nr;var Rr=Object.prototype,Br=Rr.toString;function Lr(e){return Br.call(e)}var Me=Lr;var Fr="[object Null]",Dr="[object Undefined]",Ne=D?D.toStringTag:void 0;function Wr(e){return e==null?e===void 0?Dr:Fr:Ne&&Ne in Object(e)?Ie(e):Me(e)}var R=Wr;function Ur(e){return e!=null&&typeof e=="object"}var W=Ur;var _r=Array.isArray,Re=_r;function $r(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var H=$r;var qr="[object AsyncFunction]",Vr="[object Function]",zr="[object GeneratorFunction]",Kr="[object Proxy]";function Gr(e){if(!H(e))return!1;var r=R(e);return r==Vr||r==zr||r==qr||r==Kr}var Z=Gr;var Jr=A["__core-js_shared__"],X=Jr;var Be=function(){var e=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Hr(e){return!!Be&&Be in e}var Le=Hr;var Zr=Function.prototype,Xr=Zr.toString;function Yr(e){if(e!=null){try{return Xr.call(e)}catch{}try{return e+""}catch{}}return""}var B=Yr;var Qr=/[\\^$.*+?()[\]{}|]/g,et=/^\[object .+?Constructor\]$/,rt=Function.prototype,tt=Object.prototype,ot=rt.toString,at=tt.hasOwnProperty,st=RegExp("^"+ot.call(at).replace(Qr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nt(e){if(!H(e)||Le(e))return!1;var r=Z(e)?st:et;return r.test(B(e))}var Fe=nt;function ft(e,r){return e?.[r]}var De=ft;function it(e,r){var t=De(e,r);return Fe(t)?t:void 0}var M=it;var mt=M(A,"WeakMap"),Y=mt;var lt=9007199254740991;function ut(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=lt}var Q=ut;function pt(e){return e!=null&&Q(e.length)&&!Z(e)}var We=pt;var dt=Object.prototype;function gt(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||dt;return e===t}var ee=gt;var xt="[object Arguments]";function ct(e){return W(e)&&R(e)==xt}var pe=ct;var Ue=Object.prototype,At=Ue.hasOwnProperty,yt=Ue.propertyIsEnumerable,bt=pe(function(){return arguments}())?pe:function(e){return W(e)&&At.call(e,"callee")&&!yt.call(e,"callee")},_e=bt;function ht(){return!1}var $e=ht;var ze=typeof exports=="object"&&exports&&!exports.nodeType&&exports,qe=ze&&typeof module=="object"&&module&&!module.nodeType&&module,vt=qe&&qe.exports===ze,Ve=vt?A.Buffer:void 0,wt=Ve?Ve.isBuffer:void 0,Tt=wt||$e,Ke=Tt;var jt="[object Arguments]",kt="[object Array]",St="[object Boolean]",Ot="[object Date]",Et="[object Error]",Pt="[object Function]",Ct="[object Map]",It="[object Number]",Mt="[object Object]",Nt="[object RegExp]",Rt="[object Set]",Bt="[object String]",Lt="[object WeakMap]",Ft="[object ArrayBuffer]",Dt="[object DataView]",Wt="[object Float32Array]",Ut="[object Float64Array]",_t="[object Int8Array]",$t="[object Int16Array]",qt="[object Int32Array]",Vt="[object Uint8Array]",zt="[object Uint8ClampedArray]",Kt="[object Uint16Array]",Gt="[object Uint32Array]",l={};l[Wt]=l[Ut]=l[_t]=l[$t]=l[qt]=l[Vt]=l[zt]=l[Kt]=l[Gt]=!0;l[jt]=l[kt]=l[Ft]=l[St]=l[Dt]=l[Ot]=l[Et]=l[Pt]=l[Ct]=l[It]=l[Mt]=l[Nt]=l[Rt]=l[Bt]=l[Lt]=!1;function Jt(e){return W(e)&&Q(e.length)&&!!l[R(e)]}var Ge=Jt;function Ht(e){return function(r){return e(r)}}var Je=Ht;var He=typeof exports=="object"&&exports&&!exports.nodeType&&exports,V=He&&typeof module=="object"&&module&&!module.nodeType&&module,Zt=V&&V.exports===He,de=Zt&&J.process,Xt=function(){try{var e=V&&V.require&&V.require("util").types;return e||de&&de.binding&&de.binding("util")}catch{}}(),ge=Xt;var Ze=ge&&ge.isTypedArray,Yt=Ze?Je(Ze):Ge,Xe=Yt;function Qt(e,r){return function(t){return e(r(t))}}var Ye=Qt;var eo=Ye(Object.keys,Object),Qe=eo;var ro=Object.prototype,to=ro.hasOwnProperty;function oo(e){if(!ee(e))return Qe(e);var r=[];for(var t in Object(e))to.call(e,t)&&t!="constructor"&&r.push(t);return r}var er=oo;var ao=M(A,"Map"),re=ao;var so=M(A,"DataView"),te=so;var no=M(A,"Promise"),oe=no;var fo=M(A,"Set"),ae=fo;var rr="[object Map]",io="[object Object]",tr="[object Promise]",or="[object Set]",ar="[object WeakMap]",sr="[object DataView]",mo=B(te),lo=B(re),uo=B(oe),po=B(ae),go=B(Y),L=R;(te&&L(new te(new ArrayBuffer(1)))!=sr||re&&L(new re)!=rr||oe&&L(oe.resolve())!=tr||ae&&L(new ae)!=or||Y&&L(new Y)!=ar)&&(L=function(e){var r=R(e),t=r==io?e.constructor:void 0,s=t?B(t):"";if(s)switch(s){case mo:return sr;case lo:return rr;case uo:return tr;case po:return or;case go:return ar}return r});var nr=L;var xo="[object Map]",co="[object Set]",Ao=Object.prototype,yo=Ao.hasOwnProperty;function bo(e){if(e==null)return!0;if(We(e)&&(Re(e)||typeof e=="string"||typeof e.splice=="function"||Ke(e)||Xe(e)||_e(e)))return!e.length;var r=nr(e);if(r==xo||r==co)return!e.size;if(ee(e))return!er(e).length;for(var t in e)if(yo.call(e,t))return!1;return!0}var xe=bo;async function*fr(e){let r=e.getReader();try{for(;;){let{done:t,value:s}=await r.read();if(t)return;yield s}}finally{r.releaseLock()}}async function ir(e,r){let{onMessage:t,...s}=r,n=await fetch(e,s);if(!n.ok){let u=await n.json().catch(()=>({}));throw new Error(xe(u)?`${n.status} ${n.statusText}`:JSON.stringify(u))}let d=Ee(u=>{u.type==="event"&&t(u.data)});for await(let u of fr(n.body)){let y=new TextDecoder().decode(u);d.feed(y)}}async function mr(e,r,t,s){return fetch(`https://chat.openai.com/backend-api${t}`,{method:r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)})}async function lr(e,r){await mr(e,"POST","/conversation/message_feedback",r)}async function ur(e,r,t){await mr(e,"PATCH",`/conversation/${r}`,t)}async function pr(e){await ir("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.token}`},body:JSON.stringify({action:"next",messages:[{id:G(),role:"user",content:{content_type:"text",parts:[e.prompt]}}],model:"text-davinci-002-render-next",parent_message_id:G()}),onMessage(r){var n,d,u;if(console.debug("sse message",r),r==="[DONE]"){e.onEvent({type:"done"});return}let t;try{t=JSON.parse(r)}catch(y){console.error(y);return}let s=(u=(d=(n=t.message)==null?void 0:n.content)==null?void 0:d.parts)==null?void 0:u[0];s&&e.onEvent({type:"answer",data:{text:s,messageId:t.message.id,conversationId:t.conversation_id}})}})}var se="accessToken",ne=new dr.default(10*1e3);async function ce(){if(ne.get(se))return ne.get(se);let e=await fetch("https://chat.openai.com/api/auth/session");if(e.status===403)throw new Error("CLOUDFLARE");let r=await e.json().catch(()=>({}));if(!r.accessToken)throw new Error("UNAUTHORIZED");return ne.set(se,r.accessToken),r.accessToken}async function ho(e,r){let t=await ce(),s,n=()=>{s&&ur(t,s,{is_visible:!1})},d=new AbortController;e.onDisconnect.addListener(()=>{d.abort(),n()}),await pr({token:t,prompt:r,signal:d.signal,onEvent(u){if(u.type==="done"){e.postMessage({event:"DONE"}),n();return}s=u.data.conversationId,e.postMessage(u.data)}})}U.default.runtime.onConnect.addListener(e=>{e.onMessage.addListener(async r=>{console.debug("received msg",r);try{await ho(e,r.question)}catch(t){console.error(t),e.postMessage({error:t.message}),ne.delete(se)}})});U.default.runtime.onMessage.addListener(async e=>{if(e.type==="FEEDBACK"){let r=await ce();await lr(r,e.data)}else if(e.type==="OPEN_OPTIONS_PAGE")U.default.runtime.openOptionsPage();else if(e.type==="GET_ACCESS_TOKEN")return ce()});U.default.runtime.onInstalled.addListener(e=>{e.reason==="install"&&U.default.runtime.openOptionsPage()});})();
